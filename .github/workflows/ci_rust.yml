name: "CI/Rust"
on:
  workflow_call:

jobs:
  tests:
    strategy:
      fail-fast: false
      matrix:
        rust_toolchain: ["nightly","stable"]
        cargo_test_args: [""]
    steps:
      - uses: actions/checkout@v4
      - uses: github.com/boinkor-net/ci-baseline-rust/actions/test@main
        with:
          rust_toolchain: ${{matrix.rust_toolchain}}
          cargo_test_args: ${{matrix.cargo_test_args}}
          manifest_dir: .
          apt_install_packages: "libzfslinux-dev"

  rust_fmt:
    steps:
      - uses: actions/checkout@v4
      - uses: github.com/boinkor-net/ci-baseline-rust/actions/fmt@main
        with:
          rust_toolchain: stable
          manifest_dir: .

  clippy:
    steps:
      - uses: actions/checkout@v4
      - uses: github.com/boinkor-net/ci-baseline-rust/actions/clippy@main
        with:
          manifest_dir: .
          apt_install_packages: "libzfslinux-dev"

  cargo_deny:
    steps:
      - uses: actions/checkout@v4
      - uses: github.com/boinkor-net/ci-baseline-rust/actions/cargo_deny@main
        with:
          manifest_dir: .
